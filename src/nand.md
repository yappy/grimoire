# NandGame 攻略

[NandGame](https://nandgame.com/)

1. 難しいアナログ電気の世界で我慢してなんとか 0, 1 の世界を作る。
1. 小学校の算数より簡単な世界になる。
1. 単純明快な理論をベースにそれまでできなかった速度で大量の計算ができるようになったが、
  結局、とてつもなく複雑なハードウェアとソフトウェアの世界が構築された。助けてくれ。

## AND, OR, NOT

数学や論理学で使われる「かつ」「または」「でない」だが、別にそこまで言わなくても
日常で使う範囲の理解で問題ない。
ただし「かつ」は両方 1 のときも 1 とする。
定義の問題であって数学に合わせたと思っておく。

両方 1 のときに 0 とする「または」を exclusive or (XOR; 排他的論理和) と呼ぶ。
mod 2 (2 で割った余り) の数学を使いたいときはこちらで定義すればよいし、決めの問題。
また、mod 2 とか関係なくてもどうせそのうち欲しくなる。

A AND B (A かつ B)

| A | B | OUT |
| - | - | --- |
| 0 | 0 | 0 |
| 0 | 1 | 0 |
| 1 | 0 | 0 |
| 1 | 1 | 1 |

A OR B (A または B)

| A | B | OUT |
| - | - | --- |
| 0 | 0 | 0 |
| 0 | 1 | 1 |
| 1 | 0 | 1 |
| 1 | 1 | 1 |

NOT A

| A | OUT |
| - | --- |
| 0 | 1 |
| 1 | 0 |

## OR を消す (AND を消す)

唐突だがここでド・モルガンの法則を思い出す。

\\( \overline{ A + B } = \overline{ A } \cdot \overline{ B } \\)

記号の意味を知らずに見るとうわっとなるかもしれないが、

* 上に線を引いたら NOT を表す。
* 掛け算は AND を表す。
* 足し算は OR を表す。

つまり、`NOT (A OR B) = (NOT A) AND (NOT B)` という意味である。

* A または B、ではない
* A でない、かつ、B でもない

ベン図を書けば一目瞭然だし、そもそも論理式の公式というのは A, B のような変数に
0, 1 しか入らないので全通り代入して一致するか検証するだけで厳密に証明できてしまう。

| A | B | A OR B | NOT (A OR B) |
| - | - | ------ | ------------ |
| 0 | 0 | 0 | 1 |
| 0 | 1 | 1 | 0 |
| 1 | 0 | 1 | 0 |
| 1 | 1 | 1 | 0 |

| A | B | NOT A| NOT B | (NOT A) AND (NOT B) |
| - | - | ---- | ----- | ------------------- |
| 0 | 0 | 1 | 1 | 1 |
| 0 | 1 | 1 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 |
| 1 | 1 | 0 | 0 | 0 |

この式をよく見ると、OR を消して AND にできそうな気がしてくる。
少々テクニカルだが、NOT を何とかひねり出したいという発想のもと、
まず、X の否定の否定を考える。
0 は 1 になって 0 になる。1 は 0 になって 1 になる。
そこまで考える必要もなく、当然値は変わらない。

\\( X = \overline{ \overline{ X } } \\)

A OR B に対してそれを適用する。

\\( A + B = \overline{ \overline{ A + B } } \\)

これで内側にド・モルガンの法則が使える。

\\( A + B = \overline{ \overline{ A } \cdot \overline{ B } } \\)

これで AND と NOT だけの式にできた！
ちょっとテクニカルな式変形をした気がするが、ベン図を書いて考えても簡単にできる。

また、ド・モルガンの法則は AND を OR に変えることができるので、
同様の操作で OR と NOT だけの式に変換することもできる。
実は、OR が無くても (AND がなくても)、困らないのである
(めちゃくちゃ読みづらくはなる)。

## NAND だけにもできる

NAND (なんど) とは NOT AND のことで、`A NAND B = NOT (A AND B)` である。
実は、これ1つあれば困らないことが示せる。

| A | B | A NAND B |
| - | - | ------ |
| 0 | 0 | 1 |
| 0 | 1 | 0 |
| 1 | 0 | 0 |
| 1 | 1 | 0 |

前節で AND と NOT だけあれば困らないことが分かっているので、
NAND だけを使って AND と NOT を作れないか考えてみる。

まず、`NOT A` を考える。
入力パラメータの数が違うのがやや気になるが、他にやりようがないので NAND の両辺に
A を渡してみよう。

`A NAND A`

NAND の定義の表で `A = B` である一番上と一番下の行を見ると、
ちょうど NOT になっている。
または、`A AND A = A` という公式 (証明は A に 0 と 1 を入れてそれぞれ確かめるだけ)

`A NAND A = NOT (A AND A) = NOT A`

次に AND を作りたいが、NAND は `A AND B` の NOT を取ったものだったので、
そこに NOT を被せれば `A AND B` に戻せる。

`A AND B = NOT(A NAND B)`

NOT は既に NAND だけで表せているから、AND も NAND だけで表せることが分かった。

同様の方法で NOR (のあ) だけで AND, OR, NOT すべてを表すこともできる。
以上より、NAND や NOR はそれ1つだけであらゆる論理式を記述することができるという意味で、
**万能ゲート** (universal gate) と呼ばれる。

## AND, OR, NOT があればすべての論理を表せる

細かいことを言うと、ここまでで分かったのは NAND (または NOR) は
AND, OR, NOT の組と表現能力が等しいというところまでである。

* AND, OR, NOT は機械的に NAND のみの式に変換できる。
* NAND を機械的に AND, NOT のみの式に変換できる。

実は、というほどのことでもないかもしれないが、AND, OR, NOT で
すべての論理を表すことができる。
この3つがあれば、表せないものがあって困るなんてことがないというのは
直感的に明らかかもしれない。
なのでそこから機械的に変換可能な NAND だけですべての論理が記述可能と言えるわけである。

というわけで、本当は AND, OR, NOT だけですべての論理が表せることを
証明しないといけない。
あまりちゃんとやらずに進む資料も多いし別にそれでいいとも思うが、
気になる人向けに一応証明の概略を書いておく。

### 証明の概略

まず、「すべての論理回路」という言葉が緩すぎてどう扱ったらよいか迷ってしまう。

N 入力 M 出力の論理回路というものを考えてみる。
N=3, M=2 とした場合の表を示す。

| A | B | C | OUT1 | OUT2 |
| - | - | - | ---- | ---- |
| 0 | 0 | 0 | ? | ? |
| 0 | 0 | 1 | ? | ? |
| 0 | 1 | 0 | ? | ? |
| 0 | 1 | 1 | ? | ? |
| 1 | 0 | 0 | ? | ? |
| 1 | 0 | 1 | ? | ? |
| 1 | 1 | 0 | ? | ? |
| 1 | 1 | 1 | ? | ? |

? と置いたマスが16個ある。
ここにそれぞれ好きな数 (ただし 0 または 1 に限る) を入れれば
1つの論理回路が完成する。
1行につき 2 bit の出力を決める必要があり、それは他の行からの制約を一切受けない。
なので1行につき出力パターンの組み合わせが \\( 2^2 \\) 通り、
出力ビット数 M を使って一般に表すと \\( 2^M \\) 通りある。

そして行数だが、これは入力ビットのパターン数分だけあるので例では \\( 2^3 \\) 行、
入力ビット数 N を使って一般化すると \\( 2^N \\) 行となる。

以上より、N 入力 M 出力の論理回路とは、図の ? 部分の埋め方の場合の数通りしかない。
その数は、
\\( (2^M)^(2^N) \\)
(2のM乗を、(2のN乗)乗したもの) となる。
これは当然 N, M を大きくすると爆発的に大きくはなるが、有限値ではある。

この考え方をもとに、任意の入出力サイズ N, M について AND, OR, NOT
(ここで無理に NAND だけでなんとかしようとする必要はない) だけで
全ての表のパターンを表現できることを示せばよい、という方針が立った。

次に、任意の N, M (1以上の整数) について、という部分が難しいので、
数学的帰納法を使うことを試みる。

(1) N=1, M=1 のとき、回路は以下の4通りしかない。

| A | OUT |
| - | --- |
| 0 | 0 |
| 1 | 0 |

| A | OUT |
| - | --- |
| 0 | 0 |
| 1 | 1 |

| A | OUT |
| - | --- |
| 0 | 1 |
| 1 | 0 |

| A | OUT |
| - | --- |
| 0 | 1 |
| 1 | 1 |

これらすべてを AND, OR, NOT のみで表してみよう。
と言ってもこれは大変簡単で、必要なのは NOT のみである。

* `OUT = 0`
* `OUT = A`
* `OUT = NOT A`
* `OUT = 1`

(2) 次に、サイズ (N, M) の論理回路がすべて AND, OR, NOT のみで
構成する方法があると仮定し、
サイズ (N+1, M) の論理回路 (入力ビット数が1増えた) のすべてのパターンを、
存在すると仮定した方法に AND, OR, NOT のみを組み合わせることによって
構成可能なことを示す。

(3) 同様に、(N, M) がすべて構成可能という仮定の下で、(N, M+1) も構成可能であるという
ことを示す。

(1)(2)(3) を組み合わせれば、

* (1, 1) で成り立つ
* (1, 2) で成り立つ
* (1, 3) で成り立つ
* (2, 3) で成り立つ
* ...

のように、任意の狙った (N, M) について成り立つことが言える。

## NandGame の意図

コンピュータの中身は NAND を計算できる素子と、それ同士の配線からのみでできている。
現代の IC (Integrated Circuit), LSI (Large Scale Integrated) は
シリコンをナノメートル単位で加工して、トランジスタで作った NAND ゲートを
億を超えるほどの数を作ってつなげている。

ちなみに全部 NAND なのは数学的にきれいだから、ではなく、作るのが一番簡単だかららしい。

コンピュータがのどこがすごいか、なぜ21世紀が情報化社会と呼ばれているか、
なぜ人類の科学技術を先に進めたか、という理由の本質は、
0, 1 の世界にした直後の話が小学校の算数よりも簡単だから。
大学生にこれを教えていることがばれると示しがつかないので格好をつけるために
難しい話をしようとすればできるが、本質はそこにはない。
